<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.chart.PieChart?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.layout.Region?>

<ScrollPane fitToWidth="true" style="-fx-background-color: transparent;" xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" fx:controller="org.example.controller.ReportsController">
    <VBox spacing="20" styleClass="content-area">
        <padding>
            <Insets bottom="20" left="20" right="20" top="20" />
        </padding>

        <!-- Header -->
        <HBox alignment="CENTER_LEFT" spacing="20">
            <VBox>
                <Label styleClass="page-title" text="Reports &amp; Analytics" />
                <Label style="-fx-text-fill: #666;" text="Overview of system performance and ticket metrics" />
            </VBox>
            <Region HBox.hgrow="ALWAYS" />
            <Button onAction="#handleExport" style="-fx-base: #2da44e; -fx-text-fill: white;" styleClass="btn-primary" text="ðŸ“¥ Export Data (CSV)" />
            <Button onAction="#handleRefresh" styleClass="btn-secondary" text="ðŸ”„ Refresh" />
        </HBox>

        <!-- KPI Cards -->
        <HBox spacing="15" styleClass="stats-container">
            <VBox HBox.hgrow="ALWAYS" spacing="8" styleClass="stat-card">
                <Label styleClass="stat-label" text="TOTAL TICKETS" />
                <Label fx:id="lblTotalTickets" styleClass="stat-value" text="0" />
            </VBox>
            <VBox HBox.hgrow="ALWAYS" spacing="8" styleClass="stat-card">
                <Label styleClass="stat-label" text="AVG RESOLUTION TIME" />
                <Label fx:id="lblAvgResolutionTime" styleClass="stat-value" text="0h" />
            </VBox>
            <VBox HBox.hgrow="ALWAYS" spacing="8" styleClass="stat-card">
                <Label styleClass="stat-label" text="OPEN HIGH PRIORITY" />
                <Label fx:id="lblHighPriority" style="-fx-text-fill: #d1242f;" styleClass="stat-value" text="0" />
            </VBox>
            <VBox HBox.hgrow="ALWAYS" spacing="8" styleClass="stat-card">
                <Label styleClass="stat-label" text="COMPLETION RATE" />
                <Label fx:id="lblCompletionRate" style="-fx-text-fill: #2da44e;" styleClass="stat-value" text="0%" />
            </VBox>
        </HBox>

        <Separator />

        <!-- Charts Row 1 -->
        <HBox spacing="20">
            <!-- Pie Chart: By Category -->
            <VBox spacing="10" style="-fx-background-color: white; -fx-background-radius: 8; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);" HBox.hgrow="ALWAYS">
                <padding>
                    <Insets bottom="15" left="15" right="15" top="15" />
                </padding>
                <Label style="-fx-font-weight: bold; -fx-font-size: 14px;" text="Tickets by Category" />
                <PieChart fx:id="pieChartCategory" labelsVisible="true" legendSide="BOTTOM" minHeight="300" />
            </VBox>

            <!-- Pie Chart: By Status -->
            <VBox spacing="10" style="-fx-background-color: white; -fx-background-radius: 8; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);" HBox.hgrow="ALWAYS">
                <padding>
                    <Insets bottom="15" left="15" right="15" top="15" />
                </padding>
                <Label style="-fx-font-weight: bold; -fx-font-size: 14px;" text="Tickets by Status" />
                <PieChart fx:id="pieChartStatus" labelsVisible="true" legendSide="BOTTOM" minHeight="300" />
            </VBox>
        </HBox>

        <!-- Charts Row 2 -->
        <VBox spacing="10" style="-fx-background-color: white; -fx-background-radius: 8; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);">
            <padding>
                <Insets bottom="15" left="15" right="15" top="15" />
            </padding>
            <Label style="-fx-font-weight: bold; -fx-font-size: 14px;" text="Ticket Creation Trend (Last 30 Days)" />
            <BarChart fx:id="barChartTrend" legendVisible="false" minHeight="300">
                <xAxis>
                    <CategoryAxis label="Date" side="BOTTOM" />
                </xAxis>
                <yAxis>
                    <NumberAxis label="New Tickets" side="LEFT" />
                </yAxis>
            </BarChart>
        </VBox>

    </VBox>
</ScrollPane>
