<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="org.example.controller.MainController"
            styleClass="root">

    <!-- LEFT SIDEBAR -->
    <left>
        <VBox styleClass="sidebar" spacing="0">
            <VBox styleClass="sidebar-header" alignment="CENTER">
                <Label text="ðŸŽ« TeamSupport" styleClass="sidebar-logo"/>
            </VBox>

            <Separator styleClass="sidebar-separator"/>

            <ScrollPane fitToWidth="true" fitToHeight="true"
                        style="-fx-background-color: transparent; -fx-background: transparent;">
                <VBox styleClass="sidebar-menu" VBox.vgrow="ALWAYS">
                    <Label text="MAIN" styleClass="sidebar-section-title"/>

                    <Button fx:id="btnDashboard" text="ðŸ“Š  Dashboard"
                            styleClass="sidebar-item active"
                            onAction="#handleDashboard" maxWidth="Infinity"/>

                    <Button fx:id="btnTickets" text="ðŸŽ«  My Tickets"
                            styleClass="sidebar-item"
                            onAction="#handleTickets" maxWidth="Infinity"/>

                    <Button text="ðŸ“  All Tickets"
                            styleClass="sidebar-item"
                            onAction="#handleAllTickets" maxWidth="Infinity"/>

                    <Label text="MANAGEMENT" styleClass="sidebar-section-title">
                        <VBox.margin>
                            <Insets top="10"/>
                        </VBox.margin>
                    </Label>

                    <Button fx:id="btnNewTicket" text="âž•  New Ticket"
                            styleClass="sidebar-item"
                            onAction="#handleNewTicket" maxWidth="Infinity"/>

                    <Button fx:id="btnCategories" text="ðŸ“  Categories"
                            styleClass="sidebar-item"
                            onAction="#handleCategories" maxWidth="Infinity"/>

                    <Button fx:id="btnUsers" text="ðŸ‘¥  Users"
                            styleClass="sidebar-item"
                            onAction="#handleUsers" maxWidth="Infinity"/>

                    <Button text="ðŸ“Š  Reports"
                            styleClass="sidebar-item"
                            onAction="#handleReports" maxWidth="Infinity"/>

                    <Button text="ðŸ“Š  Stats"
                            styleClass="sidebar-item"
                            onAction="#handleOpenStats"
                            maxWidth="Infinity"/>

                    <Region VBox.vgrow="ALWAYS"/>

                    <Separator styleClass="sidebar-separator">
                        <VBox.margin>
                            <Insets bottom="5"/>
                        </VBox.margin>
                    </Separator>

                    <Button text="âš™ï¸  Settings"
                            styleClass="sidebar-item"
                            onAction="#handleSettings" maxWidth="Infinity"/>

                    <Button text="ðŸšª  Logout"
                            styleClass="sidebar-item"
                            onAction="#handleLogout" maxWidth="Infinity"/>
                </VBox>
            </ScrollPane>
        </VBox>
    </left>

    <!-- MAIN CONTENT AREA -->
    <center>
        <VBox spacing="0">
            <!-- TOP HEADER -->
            <HBox styleClass="top-header" alignment="CENTER_LEFT" spacing="20">
                <Label fx:id="lblPageTitle" text="Dashboard" styleClass="header-title"/>

                <Region HBox.hgrow="ALWAYS"/>

                <TextField fx:id="searchField" promptText="ðŸ” Search tickets..."
                           styleClass="header-search" onAction="#handleSearch"/>

                <VBox styleClass="user-info" alignment="CENTER_RIGHT" spacing="2">
                    <Label fx:id="lblUsername" text="Admin User" styleClass="user-name"/>
                    <Label fx:id="lblUserRole" text="Administrator" styleClass="user-role"/>
                </VBox>
            </HBox>

            <!-- TOOLBAR -->
            <HBox fx:id="toolbarContainer" styleClass="toolbar" alignment="CENTER_LEFT"
                  spacing="12" visible="false" managed="false">
                <Button text="New Ticket" styleClass="btn-new-ticket"
                        onAction="#handleNewTicket"/>

                <ComboBox fx:id="statusFilter" promptText="Status: All"
                          styleClass="filter-combo" prefWidth="150"/>

                <ComboBox fx:id="priorityFilter" promptText="Severity: All"
                          styleClass="filter-combo" prefWidth="150"/>

                <Region HBox.hgrow="ALWAYS"/>

                <Button text="ðŸ”„ Refresh" styleClass="btn-secondary"
                        onAction="#handleRefresh"/>
            </HBox>

            <!-- CONTENT AREA WITH PROPER SCROLLING -->
            <StackPane VBox.vgrow="ALWAYS">
                <!-- Dashboard View -->
                <ScrollPane fitToWidth="true" fx:id="dashboardView" visible="true"
                            style="-fx-background-color: transparent;">
                    <VBox styleClass="content-area" spacing="20">
                        <!-- Stats Cards -->
                        <HBox styleClass="stats-container" spacing="15">
                            <VBox styleClass="stat-card" spacing="8" HBox.hgrow="ALWAYS">
                                <Label text="TOTAL TICKETS" styleClass="stat-label"/>
                                <Label fx:id="lblTotalTickets" text="0" styleClass="stat-value"/>
                                <Label text="+12 from last week" styleClass="stat-change positive"/>
                            </VBox>

                            <VBox styleClass="stat-card" spacing="8" HBox.hgrow="ALWAYS">
                                <Label text="OPEN" styleClass="stat-label"/>
                                <Label fx:id="lblOpenTickets" text="0" styleClass="stat-value"/>
                                <Label text="Pending resolution" styleClass="stat-change"/>
                            </VBox>

                            <VBox styleClass="stat-card" spacing="8" HBox.hgrow="ALWAYS">
                                <Label text="IN PROGRESS" styleClass="stat-label"/>
                                <Label fx:id="lblProgressTickets" text="0" styleClass="stat-value"/>
                                <Label text="Being worked on" styleClass="stat-change"/>
                            </VBox>

                            <VBox styleClass="stat-card" spacing="8" HBox.hgrow="ALWAYS">
                                <Label text="RESOLVED" styleClass="stat-label"/>
                                <Label fx:id="lblResolvedTickets" text="0" styleClass="stat-value"/>
                                <Label text="This month: 45" styleClass="stat-change positive"/>
                            </VBox>
                        </HBox>

                        <!-- Recent Tickets Section -->
                        <VBox spacing="10">
                            <Label text="Recent Tickets" styleClass="page-title"/>

                            <VBox style="-fx-background-color: white; -fx-border-radius: 6; -fx-background-radius: 6;">
                                <!-- FIXED: Added wrapper with fixed height -->
                                <VBox prefHeight="400" maxHeight="400">
                                    <TableView fx:id="recentTicketsTable" styleClass="tickets-table"
                                               VBox.vgrow="ALWAYS">
                                        <columns>
                                            <TableColumn text="â˜" prefWidth="40"/>
                                            <TableColumn fx:id="colTicketId" text="Number" prefWidth="100"/>
                                            <TableColumn fx:id="colTitle" text="Name" prefWidth="300"/>
                                            <TableColumn fx:id="colStatus" text="Status" prefWidth="120"/>
                                            <TableColumn fx:id="colPriority" text="Severity" prefWidth="100"/>
                                            <TableColumn fx:id="colCategory" text="Type" prefWidth="120"/>
                                            <TableColumn fx:id="colAssignedTo" text="Group" prefWidth="150"/>
                                            <TableColumn fx:id="colCreatedAt" text="Days" prefWidth="80"/>
                                        </columns>
                                        <columnResizePolicy>
                                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                                        </columnResizePolicy>
                                    </TableView>
                                </VBox>

                                <!-- Pagination -->
                                <HBox styleClass="pagination-bar" alignment="CENTER_LEFT" spacing="15">
                                    <Label fx:id="recentTicketsCountLabel" text="0 Tickets" styleClass="pagination-text"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Label text="Showing recent tickets" styleClass="pagination-text"/>
                                </HBox>
                            </VBox>
                        </VBox>
                    </VBox>
                </ScrollPane>

                <!-- All Tickets View -->
                <ScrollPane fitToWidth="true" fx:id="ticketsView" visible="false"
                            style="-fx-background-color: transparent;">
                    <VBox styleClass="content-area" spacing="10">
                        <Label text="All Tickets" styleClass="page-title"/>

                        <VBox style="-fx-background-color: white; -fx-border-radius: 6; -fx-background-radius: 6;">
                            <!-- FIXED: Added wrapper with flexible height -->
                            <VBox prefHeight="600" maxHeight="600">
                                <TableView fx:id="allTicketsTable" styleClass="tickets-table"
                                           VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn text="â˜" prefWidth="40"/>
                                        <TableColumn fx:id="colAllTicketId" text="Number" prefWidth="100"/>
                                        <TableColumn fx:id="colAllTitle" text="Name" prefWidth="300"/>
                                        <TableColumn fx:id="colAllStatus" text="Status" prefWidth="120"/>
                                        <TableColumn fx:id="colAllPriority" text="Severity" prefWidth="100"/>
                                        <TableColumn fx:id="colAllCategory" text="Type" prefWidth="120"/>
                                        <TableColumn fx:id="colAllAssignedTo" text="Group" prefWidth="150"/>
                                        <TableColumn fx:id="colAllCreatedAt" text="Days" prefWidth="80"/>
                                        <TableColumn fx:id="colAllActions" text="Actions" prefWidth="80"/>
                                    </columns>
                                    <columnResizePolicy>
                                        <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                                    </columnResizePolicy>
                                    <placeholder>
                                        <VBox styleClass="empty-state" spacing="15">
                                            <Label text="ðŸŽ«" styleClass="empty-icon"/>
                                            <Label text="No tickets found" styleClass="empty-text"/>
                                        </VBox>
                                    </placeholder>
                                </TableView>
                            </VBox>

                            <!-- Pagination -->
                            <HBox styleClass="pagination-bar" alignment="CENTER_LEFT" spacing="15">
                                <Label fx:id="allTicketsCountLabel" text="0 Tickets" styleClass="pagination-text"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Label text="All tickets in system" styleClass="pagination-text"/>
                            </HBox>
                        </VBox>
                    </VBox>
                </ScrollPane>
            </StackPane>
        </VBox>
    </center>
</BorderPane>